---
title: 'Relatório: Identificação de evasão de clientes'
author: "Samuel Gonçalves"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Introdução
Na meio empresarial, o **costumer churn** (literalmente, "mistura de clientes") ou simplesmente **churn** é uma expressão que indica a evasão ou desistência de clientes com relação à algum serviço ou contrato firmado com a empresa. A análise do churn é crítico para mercados de serviços de assinatura ou de longa duração como assinaturas de planos de celular, **streamings**. assinatura de canais de TV, **internet**, etc.
  
O **churn** pode acontecer de forma voluntária (o próprio consumidor decide livremente sair do serviço) ou involutária (por motivos de força maior, o consumidor precisa cancelar o serviço). Autores apontam que o **churn** é um indicador atrasado, isto é, apenas indica uma perca já anteriormente ocorrida, pois a evasão de clientes é resultado de uma série de acontecimentos prévios no uso do serviço ou no relacionamento com a empresa. Sendo necessário portanto, antecipar-se à perda identificando suas métricas antecedentes (**red flags**). Essas métricas ajudam a identificar quando um cliente está prestes a interromper o serviço antes de realmente parar e auxiliam na tomada da melhor decisão no caso.
  
Algumas indicadores antecedentes de **churn**:
  
* Diminuição do uso do serviço e engajamento do cliente.
* Preços não-competitivos em relação à concorrência.
* Avaliações e reclamações negativas dos atuais clientes


No presente relatório, realizamos uma investigação estatística preliminar no **dataset** fornecido pela companhia de consultoria em inteligência artificial **DHAUZ** utilizando uma metodologia inspirada no processo CRISP-DM (Shearer, 2000) e utilizando modelos estatísticos e de aprendizado de máquina, visando identificar padrões de comportamentos de clientes relacionados ao **churn** e construir um modelo que permita prever quais clientes poderão desistir do serviço no período seguinte.

## Dados

No **case** tratado nesse relatório, investigaremos os dados de uma empresa do setor de Telecomunicações e sua tarefa em busca de **insights** que ajudem a companhia a se antecipar aos **churns** e evitar a evasão dos clientes. A base está disponível [aqui](https://dhauz-challenges.s3.amazonaws.com/churn_challenge.zip) e trata-se do comportamento de clientes de uma companhia de telecomunicações. O **dataset** consiste de 100.00 observações com de 171 variáveis, sendo uma delas, a indicação se o cliente continuou ou não com o serviço. As variáveis do **dataset** foram divididas por Neslin et. al. (2004) em 3 categorias principais:
  
* *Comportamento do Consumidor*: Variáveis que dizem respeito ao uso do serviço do consumidor como minutos de uso, como minutos de uso do serviço, preço mensal pago pelo serviço, etc..  
* *Interação pela companhia*: Váriaveis que dizem respeito à interação consumidor-empresa, como número de chamadas ao serviço de atendimento ao consumidor, etc.
* *Dados demográficos*: Variáveis com características demográficas dos consumidores como 

Dentre as variáveis presentes no dataset, vale destacar:
  
| Variável 	| Categoria 	| Descrição 	| % Dados faltantes 	|
|:---:	|:---:	|:---:	|---	|
| churn 	| Binária 	| Indica se o cliente cancelou ou não o serviço   entre 30 a 60 dias após a observação. 	| 0,00% 	|
| change_mou 	| Contínua 	| Variação percentual em minutos mensais de uso   em relação à média dos três meses anteriores  	| 0,89% 	|
| change_rev 	| Contínua 	| Variação percentual em minutos mensais de gasto do consumidor relação à média dos três meses anteriores 	| 0,89% 	|
| attempt_Mean: 	| Contínua 	| Número médio de tentativas de chamadas   de realizadas 	| 0,00% 	|
| complete_Mean: 	| Contínua 	| Número médio de tentativas de chamadas   de dados realizadas e completas. 	| 0,00% 	|
| custcare_Mean 	| Contínua 	| Número médio de chamadas do cliente   ao Serviço de Atendimento ao Consumidor 	| 0,00% 	|
| months 	| Inteiro 	| Quantidade de meses que o serviço é oferecido 	| 0,00% 	|
| kid11_15 	| Inteiro 	| Quantidade de crianças   de 11 a 15 anos na residência 	| 1,73% 	|

Variáveis estas que foram escolhidas devido à baixa quantidade de dados faltantes e serem boas indicadoras da usabilidade e do relacionamento do cliente com a empresa. Dado que:
  
* As variáveis **change_mou** e **change_rev** indicam a variação do uso do serviço pelo cliente. Diminuição do uso do serviço é uma conhecida **redflag** relacionada aos **churns**.  
* As variáveis **attempted_Mean** e **completed_Mean** são indicadores da satisfação do cliente com o serviço. Visto que uma menor razão de chamadas completadas é forte indicador de insatisfação do cliente e portanto, maior probabilidade de evasão.
* 
* A variável **kid11_15** indica se há crianças entre 11 e 15 anos presente na residência. Considerando que está é a idade média em que crianças começam a utilizar smartphones próprios, a presença de um novo potencial usuário na residência pode exigir alterações no plano oferecido.

Removendo então o pequeno percentual de observações com dados ausentes (2,68%) e removendo anomalias nos dados (principalmente nas variáveis **change_mou** e **change_rev**), temos então uma análise sumarizada inicial.
Verificando as variáveis em uma análise sumarizada inicial.
```{r echo=FALSE, warning=FALSE}
summary(X[,-c(1,8)])

```
```{r echo=FALSE}
summary(X$kid11_15)

```



Analisando agora para as observações classificadas como **churn**
```{r echo=FALSE, warning=FALSE}
summary(X[X$churn==1,-c(1,8)])

```
E agora para as observações não classificadas como **churn** (cliente evadido):
```{r echo=FALSE, warning=FALSE}
summary(X[X$churn==0,-c(1,8)])

```
É notável que as variáveis **change_mou** e **change_rev** tem médias menores no grupo de clientes que cancelaram o serviço. Condizente com o esperado. Além disso, há uma média menor de tentativas de ligações realizadas e menor de ligações completadas em clientes que realizaram **churn**, indicando que de fato há uma diferença significativa e influência da taxa de sucesso em completar ligações com permanecer no serviço.  
Criamos então uma nova variável **rate_call** que indica a razão de ligações bem-sucedidas realizadas pelo cliente, isto é, a razão das variáveis **complete_Mean** e **attempt_Mean**. Temos assim, sua estatística resumo:

```{r echo=FALSE}
summary(X$rate_call)
```
Obs: Como alguns clientes não realizaram tentativas de ligação no período e a divisão por zero não é possível, fixamos o **rate_call** desses clientes em zero.  
  
Analisando agora o **rate_call** para clientes evadidos (realizaram **churn**):
```{r}
summary(X$rate_call[X$churn==1])
```
E para os clientes que não realizaram **churn**:
```{r echo=FALSE}
summary(X$rate_call[X$churn==0])
```
Como esperado, a média de tentativas bem-sucedidas de ligação é menor em clientes que evadiram do serviço. Indicando que este pode ser tomado como indicador de satisfação com o uso do servição e preditor para o **churn** do cliente.

## Predição
Vamos desenvolver agora modelos preditivos preliminares que nos permitam inferir quais clientes podem cancelar o serviço dado seu histórico recente de utilização/relacionamento com a empresa/situação familiar atual.  
Para isso, desenvolveremos 3 modelos baseados em métodos para classificação binária. São eles **regressão logística**, **análise discriminante** e **Random Forest**. Com isso, desenvolvemos 3 modelos.

* *Regressão Logística*: Com as variáveis preditoras **change_mou**, **change_rev**, **custcare_Mean**, **months**, **rate_call** e **kid11_15** e a função de ligação logística.
* *Análise Discriminante Linear*: Com as mesmas variáveis preditoras.
* *Random Forest*: Com as mesmas variáveis preditoras, utilizando 75 árvores de decisão.
  
Os 3 modelos foram treinados considerando 80% das observações, e como as classes de **churn** e ausência de **churn** estão balanceadas (48,08% de **churn**), nenhum procedimento de **data augmentation foi necessário.
